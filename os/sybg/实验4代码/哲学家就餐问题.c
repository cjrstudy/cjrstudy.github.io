/*
	ԭ????????ѧ?ҵ????֧??Ӷ????????????????ӽ??͡?
	?????????
	??̣??ѧ??
*/

#include <stdio.h>
#include <pthread.h>
#include <semaphore.h>

// ?????????5֧???
sem_t chopstick[5];

int a = 0;

// ?ѧ??߳?
void *philosopher(void *arg)
{
	int id = a++;	// ??߿?ӵı????ѧ?ұ?
	int left, right;

	while(1)
	{
		sleep(1);
		sem_getvalue(&chopstick[id], &left);		//??????ź?????????????left
		sem_getvalue(&chopstick[(id + 1) % 5], &right);	//??????ź?????????????right

		  // ???п?????п??
		if(left == 1 && right == 1)
		{
			//????ߵĿ??
			sem_wait(&chopstick[id]);
			//????ߵĿ??
			sem_wait(&chopstick[(id + 1) % 5]);

			// ?Է?
			printf("%d?????????Ͳ?n", id);
		
			// ?????Ŀ??
			sem_post(&chopstick[id]);
			// ???ұߵĿ??
			sem_post(&chopstick[(id + 1) % 5]);

		}

		
	}

}

void main()
{
	int i;

	//??ʼ??????
	for(i = 0; i < 5; i++)
		sem_init(&chopstick[i], 0, 1);

	//?????D
	pthread_t philosopher_tid[5];

	//????5???ѧ??߳?
	for(i = 0; i < 5; i++)
		pthread_create(&philosopher_tid[i], NULL, philosopher, NULL);

	//???߳?
	for(i = 0; i < 5; i++)
		pthread_join(philosopher_tid[i], NULL);
	
}